8051 Assembler           Version 1.00   02/02/121 18:41:07    Page 1
D:\8051\MPF\Simulations\MPF.a51



    1 0000              ORG 0000H
    2 0000 020050       JMP MAIN
    3 0003              
    4 0003              
    5 0050              ORG 0050H
    6 0050              MAIN:
    7 0050 75B00F               MOV P3, #00FH ; Clear rows of keyboard
    8 0053 C288                 CLR IT0 ; Active low interrupt
    9 0055 7800                 MOV R0, #000H ; R0 is a status register and 00 is equal to start and waiting for pc
   10 0057 7900                 MOV R1, #000H ; R1 is a value register whivh we store the value of recent pushed key of key boards in it
   11 0059 D2AF                 SETB EA ; Enable interrupt individually
   12 005B D2A8                 SETB EX0 ; Enable external interrupt0
   13 005D BE01FD               STATUS0: CJNE R6, #001H, STATUS0 ; Status 1 will happen only if user push PC button
   14 0060                      
   15 0060 020050       JMP MAIN
   16 0063              
   17 0063              ; Subroutine for detecting the key
   18 0063              DETECTION:
   19 0063 20A025               COLUMN_ONE: JB P2.0, COLUMN_TWO ; If P2.0 is high the key is not from the first column of left key board
   20 0066                              ; The key is from the first column
   21 0066                              ZERO:
   22 0066 B2B4                                 CPL P3.4 ; Set the first row of key board
   23 0068 30A005                               JNB P2.0, EIGHT ; If P2.0 is low after setting P3.4 the key is not 0
   24 006B 7900                                 MOV R1, #000H ; the key is 0
   25 006D B2B4                                 CPL P3.4 ; Clear the first row of key boards
   26 006F 22                                   RET
   27 0070                              EIGHT:
   28 0070 B2B4                                 CPL P3.4 ; Clear the first row of key board
   29 0072 B2B5                                 CPL P3.5 ; Set the first row of key board
   30 0074 30A005                               JNB P2.0, PC ; If P2.0 is low after setting P3.5 the key is not 8
   31 0077 7908                                 MOV R1, #008H ; the key is 8
   32 0079 B2B5                                 CPL P3.5 ; Clear the second row of key boards
   33 007B 22                                   RET
   34 007C                              PC:
   35 007C B2B5                                 CPL P3.5 ; Clear the second row of key board
   36 007E B2B6                                 CPL P3.6 ; Set the third row of key board
   37 0080 30A005                               JNB P2.0, F1 ; If P2.0 is low after setting P3.6 the key is not PC
   38 0083 7910                                 MOV R1, #010H ; the key is PC
   39 0085 B2B6                                 CPL P3.6 ; Clear the third row of key boards
   40 0087 22                                   RET
   41 0088                              F1:
   42 0088 7920                                 MOV R1, #020H ; The key is F1
   43 008A 22                                   RET
   44 008B 20A125               COLUMN_TWO: JB P2.1, COLUMN_THREE ; If P2.1 is high the key is not from the second column of left key board
   45 008E                              ; The key is from the second column
   46 008E                              ONE:
   47 008E B2B4                                 CPL P3.4 ; Set the first row of key board
   48 0090 30A105                               JNB P2.1, NINE ; If P2.1 is low after setting P3.4 the key is not 1
   49 0093 7901                                 MOV R1, #001H ; the key is 1
   50 0095 B2B4                                 CPL P3.4 ; Clear the first row of key boards
   51 0097 22                                   RET
   52 0098                              NINE:
   53 0098 B2B4                                 CPL P3.4 ; Clear the first row of key board
   54 009A B2B5                                 CPL P3.5 ; Set the first row of key board
   55 009C 30A105                               JNB P2.1, ADR ; If P2.1 is low after setting P3.5 the key is not 9
   56 009F 7909                                 MOV R1, #009H ; the key is 9
   57 00A1 B2B5                                 CPL P3.5 ; Clear the second row of key boards
8051 Assembler           Version 1.00   02/02/121 18:41:07    Page 2
D:\8051\MPF\Simulations\MPF.a51



   58 00A3 22                                   RET
   59 00A4                              ADR:
   60 00A4 B2B5                                 CPL P3.5 ; Clear the second row of key board
   61 00A6 B2B6                                 CPL P3.6 ; Set the third row of key board
   62 00A8 30A105                               JNB P2.1, F2 ; If P2.1 is low after setting P3.6 the key is not ADR
   63 00AB 7930                                 MOV R1, #030H ; the key is ADR
   64 00AD B2B6                                 CPL P3.6 ; Clear the third row of key boards
   65 00AF 22                                   RET
   66 00B0                              F2:
   67 00B0 7940                                 MOV R1, #040H ; The key is F1
   68 00B2 22                                   RET
   69 00B3 20A225               COLUMN_THREE: JB P2.2, COLUMN_FOUR ; If P2.2 is high the key is not from the third column of left key board
   70 00B6                              ; The key is from the third column
   71 00B6                              TWO:
   72 00B6 B2B4                                 CPL P3.4 ; Set the first row of key board
   73 00B8 30A205                               JNB P2.2, A ; If P2.2 is low after setting P3.4 the key is not 2
   74 00BB 7902                                 MOV R1, #002H ; the key is 2
   75 00BD B2B4                                 CPL P3.4 ; Clear the first row of key boards
   76 00BF 22                                   RET
   77 00C0                              A:
   78 00C0 B2B4                                 CPL P3.4 ; Clear the first row of key board
   79 00C2 B2B5                                 CPL P3.5 ; Set the first row of key board
   80 00C4 30A205                               JNB P2.2, PLUS ; If P2.2 is low after setting P3.5 the key is not A
   81 00C7 790A                                 MOV R1, #00AH ; the key is A
   82 00C9 B2B5                                 CPL P3.5 ; Clear the second row of key boards
   83 00CB 22                                   RET
   84 00CC                              PLUS:
   85 00CC B2B5                                 CPL P3.5 ; Clear the second row of key board
   86 00CE B2B6                                 CPL P3.6 ; Set the third row of key board
   87 00D0 30A205                               JNB P2.2, F3 ; If P2.2 is low after setting P3.6 the key is not PLUS
   88 00D3 7950                                 MOV R1, #050H ; the key is PLUS
   89 00D5 B2B6                                 CPL P3.6 ; Clear the third row of key boards
   90 00D7 22                                   RET
   91 00D8                              F3:
   92 00D8 7960                                 MOV R1, #060H ; The key is F3
   93 00DA 22                                   RET
   94 00DB 20A325               COLUMN_FOUR: JB P2.3, COLUMN_FIVE ; If P2.3 is high the key is not from the fourth column of left key board
   95 00DE                              ; The key is from the fourth column
   96 00DE                              THREE:
   97 00DE B2B4                                 CPL P3.4 ; Set the first row of key board
   98 00E0 30A305                               JNB P2.3, B ; If P2.3 is low after setting P3.4 the key is not 3
   99 00E3 7903                                 MOV R1, #003H ; the key is 3
  100 00E5 B2B4                                 CPL P3.4 ; Clear the first row of key boards
  101 00E7 22                                   RET
  102 00E8                              B:
  103 00E8 B2B4                                 CPL P3.4 ; Clear the first row of key board
  104 00EA B2B5                                 CPL P3.5 ; Set the first row of key board
  105 00EC 30A305                               JNB P2.3, MINUS ; If P2.3 is low after setting P3.5 the key is not B
  106 00EF 790B                                 MOV R1, #00BH ; the key is B
  107 00F1 B2B5                                 CPL P3.5 ; Clear the second row of key boards
  108 00F3 22                                   RET
  109 00F4                              MINUS:
  110 00F4 B2B5                                 CPL P3.5 ; Clear the second row of key board
  111 00F6 B2B6                                 CPL P3.6 ; Set the third row of key board
  112 00F8 30A305                               JNB P2.3, F4 ; If P2.3 is low after setting P3.6 the key is not MINUS
  113 00FB 7970                                 MOV R1, #070H ; the key is MINUS
  114 00FD B2B6                                 CPL P3.6 ; Clear the third row of key boards
8051 Assembler           Version 1.00   02/02/121 18:41:07    Page 3
D:\8051\MPF\Simulations\MPF.a51



  115 00FF 22                                   RET
  116 0100                              F4:
  117 0100 7980                                 MOV R1, #080H ; The key is F4
  118 0102 22                                   RET
  119 0103 20A425               COLUMN_FIVE: JB P2.4, COLUMN_SIX ; If P2.4 is high the key is not from the first column of right key board
  120 0106                              ; The key is from the fifth column
  121 0106                              FOUR:
  122 0106 B2B4                                 CPL P3.4 ; Set the first row of key board
  123 0108 30A405                               JNB P2.4, C ; If P2.4 is low after setting P3.4 the key is not 4
  124 010B 7904                                 MOV R1, #004H ; the key is 4
  125 010D B2B4                                 CPL P3.4 ; Clear the first row of key boards
  126 010F 22                                   RET
  127 0110                              C:
  128 0110 B2B4                                 CPL P3.4 ; Clear the first row of key board
  129 0112 B2B5                                 CPL P3.5 ; Set the first row of key board
  130 0114 30A405                               JNB P2.4, DATA ; If P2.4 is low after setting P3.5 the key is not C
  131 0117 790C                                 MOV R1, #00CH ; the key is C
  132 0119 B2B5                                 CPL P3.5 ; Clear the second row of key boards
  133 011B 22                                   RET
  134 011C                              DATA:
  135 011C B2B5                                 CPL P3.5 ; Clear the second row of key board
  136 011E B2B6                                 CPL P3.6 ; Set the third row of key board
  137 0120 30A405                               JNB P2.4, F5 ; If P2.4 is low after setting P3.6 the key is not DATA
  138 0123 7990                                 MOV R1, #090H ; the key is DATA
  139 0125 B2B6                                 CPL P3.6 ; Clear the third row of key boards
  140 0127 22                                   RET
  141 0128                              F5:
  142 0128 79A0                                 MOV R1, #0A0H ; The key is F5
  143 012A 22                                   RET
  144 012B 20A525               COLUMN_SIX: JB P2.5, COLUMN_SEVEN ; If P2.5 is high the key is not from the second column of right key board
  145 012E                              ; The key is from the sixth column
  146 012E                              FIVE:
  147 012E B2B4                                 CPL P3.4 ; Set the first row of key board
  148 0130 30A505                               JNB P2.5, D ; If P2.5 is low after setting P3.4 the key is not 5
  149 0133 7905                                 MOV R1, #005H ; the key is 5
  150 0135 B2B4                                 CPL P3.4 ; Clear the first row of key boards
  151 0137 22                                   RET
  152 0138                              D:
  153 0138 B2B4                                 CPL P3.4 ; Clear the first row of key board
  154 013A B2B5                                 CPL P3.5 ; Set the first row of key board
  155 013C 30A505                               JNB P2.5, MODE ; If P2.5 is low after setting P3.5 the key is not D
  156 013F 790D                                 MOV R1, #00DH ; the key is D
  157 0141 B2B5                                 CPL P3.5 ; Clear the second row of key boards
  158 0143 22                                   RET
  159 0144                              MODE:
  160 0144 B2B5                                 CPL P3.5 ; Clear the second row of key board
  161 0146 B2B6                                 CPL P3.6 ; Set the third row of key board
  162 0148 30A505                               JNB P2.5, F6 ; If P2.5 is low after setting P3.6 the key is not MOD
  163 014B 79B0                                 MOV R1, #0B0H ; the key is MOD
  164 014D B2B6                                 CPL P3.6 ; Clear the third row of key boards
  165 014F 22                                   RET
  166 0150                              F6:
  167 0150 79C0                                 MOV R1, #0C0H ; The key is F6
  168 0152 22                                   RET
  169 0153 20A625               COLUMN_SEVEN: JB P2.6, COLUMN_EIGHT ; If P2.6 is high the key is not from the third column of right key board
  170 0156                              ; The key is from the seventh column
  171 0156                              SIX:
8051 Assembler           Version 1.00   02/02/121 18:41:07    Page 4
D:\8051\MPF\Simulations\MPF.a51



  172 0156 B2B4                                 CPL P3.4 ; Set the first row of key board
  173 0158 30A605                               JNB P2.6, E ; If P2.6 is low after setting P3.4 the key is not 6
  174 015B 7906                                 MOV R1, #006H ; the key is 6
  175 015D B2B4                                 CPL P3.4 ; Clear the first row of key boards
  176 015F 22                                   RET
  177 0160                              E:
  178 0160 B2B4                                 CPL P3.4 ; Clear the first row of key board
  179 0162 B2B5                                 CPL P3.5 ; Set the first row of key board
  180 0164 30A605                               JNB P2.6, EXE ; If P2.6 is low after setting P3.5 the key is not E
  181 0167 790E                                 MOV R1, #00EH ; the key is E
  182 0169 B2B5                                 CPL P3.5 ; Clear the second row of key boards
  183 016B 22                                   RET
  184 016C                              EXE:
  185 016C B2B5                                 CPL P3.5 ; Clear the second row of key board
  186 016E B2B6                                 CPL P3.6 ; Set the third row of key board
  187 0170 30A605                               JNB P2.6, F7 ; If P2.6 is low after setting P3.6 the key is not EXE
  188 0173 79D0                                 MOV R1, #0D0H ; the key is EXE
  189 0175 B2B6                                 CPL P3.6 ; Clear the third row of key boards
  190 0177 22                                   RET
  191 0178                              F7:
  192 0178 79E0                                 MOV R1, #0E0H ; The key is F1
  193 017A 22                                   RET
  194 017B                      COLUMN_EIGHT:
  195 017B                              ; The key is from the eighths column
  196 017B                              SEVEN:
  197 017B B2B4                                 CPL P3.4 ; Set the first row of key board
  198 017D 30A705                               JNB P2.7, F ; If P2.7 is low after setting P3.4 the key is not 7
  199 0180 7907                                 MOV R1, #007H ; the key is 7
  200 0182 B2B4                                 CPL P3.4 ; Clear the first row of key boards
  201 0184 22                                   RET
  202 0185                              F:
  203 0185 B2B4                                 CPL P3.4 ; Clear the first row of key board
  204 0187 B2B5                                 CPL P3.5 ; Set the first row of key board
  205 0189 30A705                               JNB P2.7, END ; If P2.7 is low after setting P3.5 the key is not F
  206 018C 790F                                 MOV R1, #00FH ; the key is F
  207 018E B2B5                                 CPL P3.5 ; Clear the second row of key boards
  208 0190 22                                   RET
  209 0191                              END:
  210 0191 B2B5                                 CPL P3.5 ; Clear the second row of key board
  211 0193 B2B6                                 CPL P3.6 ; Set the third row of key board
  212 0195 30A705                               JNB P2.7, F8 ; If P2.7 is low after setting P3.6 the key is not END
  213 0198 79F0                                 MOV R1, #0F0H ; the key is END
  214 019A B2B6                                 CPL P3.6 ; Clear the third row of key boards
  215 019C 22                                   RET
  216 019D                              F8:
  217 019D 79F1                                 MOV R1, #0F1H ; The key is F8
  218 019F 22                                   RET
  219 01A0              
  220 01A0              
  221 01A0              ; ISR
  222 0003              ORG 0003H
  223 0003 C2B1         CLR P3.1 ; Disable interrupt
  224 0005 C2AF         CLR EA ; No interrupt will be acknowledged
  225 0007 C2A8         CLR EX0 ; Disable external interrupt0
  226 0009 120063       CALL DETECTION
  227 000C C289         CLR IE0
  228 000E              
8051 Assembler           Version 1.00   02/02/121 18:41:07    Page 5
D:\8051\MPF\Simulations\MPF.a51



  229 000E 32           RETI

Defined Symbols:

Defined Labels:
  A                                         0000C0  192
  ADR                                       0000A4  164
  B                                         0000E8  232
  C                                         000110  272
  COLUMN_EIGHT                              00017B  379
  COLUMN_FIVE                               000103  259
  COLUMN_FOUR                               0000DB  219
  COLUMN_ONE                                000063  99
  COLUMN_SEVEN                              000153  339
  COLUMN_SIX                                00012B  299
  COLUMN_THREE                              0000B3  179
  COLUMN_TWO                                00008B  139
  D                                         000138  312
  DATA                                      00011C  284
  DETECTION                                 000063  99
  E                                         000160  352
  EIGHT                                     000070  112
  END                                       000191  401
  EXE                                       00016C  364
  F                                         000185  389
  F1                                        000088  136
  F2                                        0000B0  176
  F3                                        0000D8  216
  F4                                        000100  256
  F5                                        000128  296
  F6                                        000150  336
  F7                                        000178  376
  F8                                        00019D  413
  FIVE                                      00012E  302
  FOUR                                      000106  262
  MAIN                                      000050  80
  MINUS                                     0000F4  244
  MODE                                      000144  324
  NINE                                      000098  152
  ONE                                       00008E  142
  PC                                        00007C  124
  PLUS                                      0000CC  204
  SEVEN                                     00017B  379
  SIX                                       000156  342
  STATUS0                                   00005D  93
  THREE                                     0000DE  222
  TWO                                       0000B6  182
  ZERO                                      000066  102
